{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacoesView","Mensagem","MensagemView","NegociacaoService","getNegociacaoDao","DataInvalidaException","Negociacao","Bind","DateConverter","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listaTodos","negociacoes","forEach","negociacao","adiciona","catch","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","console","log","stack","message","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obterNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes } from '../domain/negociacao/Negociacoes.js'\nimport { NegociacoesView } from '../ui/views/NegociacoesView.js';\nimport { Mensagem } from '../ui/models/Mensagem.js';\nimport { MensagemView } from '../ui/views/MensagemView.js';\nimport { NegociacaoService } from '../domain/negociacao/NegociacaoService.js';\nimport { getNegociacaoDao } from '../util/DaoFactory.js';\nimport { DataInvalidaException } from '../ui/converters/DataInvalidaException.js';\nimport { Negociacao } from '../domain/negociacao/Negociacao.js';\nimport { Bind } from '../util/Bind.js';\nimport { DateConverter } from '../ui/converters/DateConverter.js';\nexport class NegociacaoController {\n  constructor() {\n    // não vamos atribuir outor valor à variável\n    const $ = document.querySelector.bind(document);\n    this._inputData = $('#data');\n    this._inputQuantidade = $('#quantidade');\n    this._inputValor = $('#valor');\n\n    // não passamos mais \"adiciona\" e \"esvazia\" dentro de um array\n    this._negociacoes = new Bind(\n      new Negociacoes(),\n      new NegociacoesView('#negociacoes'),\n      'adiciona', 'esvazia'\n    );\n    // não passamos mais \"texto\" dentro de um array\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView('#mensagemView'),\n      'texto'\n    );\n\n    this._service = new NegociacaoService();\n\n    // chama o método de inicialização\n    this._init();\n  }\n\n  _init() {\n    getNegociacaoDao()\n      .then(dao => dao.listaTodos())\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._negociacoes.adiciona(negociacao)))\n      .catch(err => this._mensagem.texto = err);\n  }\n\n  adiciona(event) {\n    try {\n      event.preventDefault();\n      // negociação que precisamos incluir no banco e na tabela\n      const negociacao = this._criaNegociacao();\n      getNegociacaoDao()\n        .then(dao => dao.adiciona(negociacao))\n        .then(() => {\n          // só tentará incluir na tabela se conseguiu antes incluir no banco\n          this._negociacoes.adiciona(negociacao)\n          this._mensagem.texto = 'Negociação adicionada com sucesso';\n          this._limpaFormulario();\n        })\n        .catch(err => this._mensagem.texto = err);\n    } catch (err) {\n      console.log(err);\n      console.log(err.stack);\n      // TESTA SE O TIPO DO ERRO É DE DATA,\n      // SE FOR, EXIBE MENSAGEM PARA O USUÁRIO\n      if (err instanceof DataInvalidaException) {\n        this._mensagem.texto = err.message;\n      } else {\n        // mensagem genérica para qualquer problema que possa acontecer  \n        this._mensagem.texto = 'Um erro não esperado aconteceu. Entre em contato com o suporte';\n      }\n    }\n\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = '';\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0\n    this._inputData.focus();\n  }\n\n  _criaNegociacao() {\n    // retorna uma instância de negociação\n    return new Negociacao(\n      DateConverter.paraData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value),\n    );\n  }\n\n  apaga() {\n    getNegociacaoDao()\n      .then(dao => dao.apagaTodos())\n      .then(() => {\n        this._negociacoes.esvazia();\n        this._mensagem.texto = 'Negociações apagadas com sucesso';\n      })\n      .catch(err => this._mensagem.texto = err);\n  }\n\n  importaNegociacoes() {\n    this._service\n      .obterNegociacoesDoPeriodo()\n      .then(negociacoes => {\n        // periodo ainda é um array com 3 elementos que são arrays\n        negociacoes\n          .filter(novaNegociacao => !this._negociacoes.paraArray().some(negociacaoExistente =>\n            novaNegociacao.equals(negociacaoExistente)))\n          .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n        this._mensagem.texto = 'Negociações do período importadas com sucesso';\n      })\n      .catch(err => this._mensagem.texto = err);\n  }\n\n}\n"]}