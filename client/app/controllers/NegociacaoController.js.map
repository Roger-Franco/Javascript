{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDao","Bind","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listaTodos","negociacoes","forEach","negociacao","adiciona","catch","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","console","log","stack","message","value","focus","paraData","parseInt","parseFloat","importaNegociacoes","obtemNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DataInvalidaException, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind } from '../util/index.js';\n\nexport class NegociacaoController {\n\n  constructor() {\n\n    const $ = document.querySelector.bind(document);\n    this._inputData = $('#data');\n    this._inputQuantidade = $('#quantidade');\n    this._inputValor = $('#valor');\n\n    this._negociacoes = new Bind(\n      new Negociacoes(),\n      new NegociacoesView('#negociacoes'),\n      'adiciona', 'esvazia'\n    );\n\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView('#mensagemView'),\n      'texto'\n    );\n\n    this._service = new NegociacaoService();\n\n    this._init();\n  }\n\n  _init() {\n\n    getNegociacaoDao()\n      .then(dao => dao.listaTodos())\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._negociacoes.adiciona(negociacao)))\n      .catch(err => this._mensagem.texto = err);\n  }\n\n  adiciona(event) {\n\n    event.preventDefault();\n\n    try {\n\n      const negociacao = this._criaNegociacao();\n\n      getNegociacaoDao()\n        .then(dao => dao.adiciona(negociacao))\n        .then(() => {\n          this._negociacoes.adiciona(negociacao);\n          this._mensagem.texto = 'Negociação adicionada com sucesso';\n          this._limpaFormulario();\n        })\n        .catch(err => this._mensagem.texto = err);\n\n    } catch (err) {\n\n      console.log(err);\n      console.log(err.stack);\n\n      if (err instanceof DataInvalidaException) {\n\n        this._mensagem.texto = err.message;\n\n      } else {\n\n        this._mensagem.texto = 'Um erro não esperado aconteceu. Entre em contato com o suporte';\n      }\n    }\n  }\n\n  _limpaFormulario() {\n\n    this._inputData.value = '';\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0\n    this._inputData.focus();\n  }\n\n  _criaNegociacao() {\n\n    return new Negociacao(\n      DateConverter.paraData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value)\n    );\n  }\n\n  importaNegociacoes() {\n\n    this._service\n      .obtemNegociacoesDoPeriodo()\n      .then(negociacoes => {\n\n        negociacoes.filter(novaNegociacao =>\n\n          !this._negociacoes.paraArray().some(negociacaoExistente =>\n\n            novaNegociacao.equals(negociacaoExistente)))\n\n          .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\n        this._mensagem.texto = 'Negociações do período importadas com sucesso';\n      })\n      .catch(err => this._mensagem.texto = err);\n  }\n\n  apaga() {\n\n    getNegociacaoDao()\n      .then(dao => dao.apagaTodos())\n      .then(() => {\n        this._negociacoes.esvazia();\n        this._mensagem.texto = 'Negociações apagadas com sucesso';\n      })\n      .catch(err => this._mensagem.texto = err);\n  }\n}"]}